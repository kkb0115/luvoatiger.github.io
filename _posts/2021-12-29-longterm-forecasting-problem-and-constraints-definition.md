---
layout: post
title: 장기 부하 예측 문제 정의 및 제약 사항 분석
date: 2021-12-29
excerpt: "longterm forecasting problem and constraints definition"
tags: [long term forecasting]
comment: true
---

# 개요
회사에서 풀려고 시도했던 장기 부하 예측 문제의 전체적인 히스토리를 정리하는 페이지. 정리할 내용은 다음과 같다.
- 요구사항 분석 및 제약 사항 확인
- 데이터 명세 및 DB 스키마 정의
- 데이터 분석 및 알고리즘 개발
- 예측 결과 시각화


## 요구사항 배경
- 대규모 IT 시스템을 운영하는 회사에서는 부하를 처리할 수 있도록 시스템 용량을 계획한다. 이를 capacity planning이라고 한다.
- capacity planning에서 장비를 추가할지 의사 결정을 내려야 하는데, 추가하기로 해도 실제로 시스템이 증설되기까지 오래 걸린다.
- 따라서 현재까지의 데이터를 바탕으로 설비가 추가될 시점의 성능 지표 값을 정확히 예측해서, 장비 증설 여부를 결정하려는 것이다.


## 요구사항 분석
- 현재까지의 데이터를 바탕으로 최소 3개월부터 최대 12개월 뒤의 성능 지표 값을 추정한다.
- 예측 정확도를 높이기 위해, 학습 데이터의 기간에 따라서 예측 기간을 자동으로 산출하도록 한다.

## 제약 사항
- 프로젝트를 시작하고 나서부터 실제 데이터를 수집하게 되므로, 학습 데이터 양이 적다. 프로젝트는 보통 몇 개월 단위로만 진행되고 데이터는 일단위로 집계되므로, Row가 수십개 정도만 수집된다. 따라서, 알고리즘을 고안할 때 실시간 예측에 쓰이는 Ml/DL 방법론을 사용할 수 없다.
  - 1년을 학습해서, 1년을 예측한다면 딥러닝 알고리즘의 인풋/아웃풋은 다음처럼 구성할 수 있다.
   - $$ Input : \left[{y}_{t-365}, {y}_{t-364}, {y}_{t-363}, ...., {y}_{t-2}, {y}_{t-1}\right] $$
   - $$ Output : \left[{y}_{t+1}, {y}_{t+2}, {y}_{t+3}, ...., {y}_{t+364}, {y}_{t+365}\right]$$
  - 따라서, 이런 구조에서 배치의 개수를 충분히 확보하려면 최소 수십년 내지 수백년치의 데이터가 필요하다.
  - 그리고 마지막 학습은 2년전부터 1년전까지의 데이터가 입력이 되고 1년전부터 현재까지의 데이터가 출력이 되는데, 1년전까지의 데이터를 학습해서 현재부터 미래를 예측하는 것은 최근 1년전부터 현재까지 데이터(히스토리)가 반영되지 않는 문제가 있다.

- 이론만 중요한 게 아니라 현실성을 고려해서 알고리즘을 설계해야 한다. 예를 들어, ARIMA의 예측 평균값은 장기적으로 0으로 수렴하게 된다. 그런데 초당 트랜잭션 건수(TPS) 지표에 ARIMA를 적용해서 예측값이 장기간 발산하거나 0으로 수렴해버리면, 이는 트랜잭션이 폭증하거나 흐르지 않는다는 의미이므로 해당 WAS에 장애가 장기간 이어질 것으로 추정된다는 뜻이 된다. 하지만, 실제로는 고객사에서 장애를 바로 조치할 것이기 떄문에 장애는 심하면 보통 몇 시간 정도만 이어진다. 따라서 수개월 동안 계속 장애가 예측된다면 고객사는 해당 알고리즘을 신뢰할 수 없다. 

- 이미 알려진 모형 하나를 모든 지표에 적용할 수 없다. 모형이 잘 포착하는 패턴은 정해져 있고, 지표별로 패턴은 전부 다른데 솔루션에 탑재되어 납품되므로 모델러가 직접 실데이터를 보고 해당 지표에 맞는 알고리즘을 변경해 줄 수도 없기 떄문이다. 예를 들어, 힙 메모리 사용량은 순차적으로 증가하다가 Garbage Collection을 하게 되면 뚝 떨어지는 번개 모양 패턴이다. 반면, 스왑 메모리 사용량은 평소에는 적다가 디스크가 부족해지면 사용량이 늘어나는 계단 모양의 패턴이다. 물론, stationarity를 만족하는 지표들도 있다. 결론적으로, 지표별로 다른 패턴을 전부 고려해서 가장 타당한 예측 알고리즘을 새로 개발해야 한다.
